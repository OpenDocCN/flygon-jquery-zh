- en: Chapter 3. Analytics, long forms, and frontend validation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Time for growth. Business is picking up and nothing says big business like massive
    forms, metrics, and customized experiences.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover:'
  prefs: []
  type: TYPE_NORMAL
- en: Google Static Maps
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Google Analytics
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Long and multi-page forms
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Integrating jQuery Validate
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Google Static Maps
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the last chapter, we completely geeked out on how to dynamically link directly
    into the native GPS systems of iOS and Android. Now, let's consider another approach.
    The client wanted the opportunity to show the user the street address, a map,
    and give them another chance to call for delivery. In this case, simply linking
    to the native GPS systems won't suffice. We can still trigger that if the user
    clicks on the address or the map, but as a step in between, we can inject a static
    map from Google ([https://developers.google.com/maps/documentation/staticmaps/](https://developers.google.com/maps/documentation/staticmaps/)).
  prefs: []
  type: TYPE_NORMAL
- en: Is it as whiz-bang as bringing up the app directly to start the turn-by-turn
    directions? Nope, but it's a heck of a lot faster and may be all that the user
    needs. They may instantly recognize the location and decide that, yes actually,
    they would rather call instead. Remember to always approach things from the user's
    perspective. It's not always about doing the coolest thing we can.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s take a look at the drawing that was approved by the client:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Google Static Maps](img/0069_03_00.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Let''s look at the code for this page which we''ll put into `/map.php`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Take note of the use of the microformat ([http://microformats.org/](http://microformats.org/))
    used to mark up the address. This is not necessary but it is pretty standard since
    2007, and it''s a good way to give your information a little more semantic value.
    That means that not only can people read it, but even computers can read it and
    make sense of it. If you''d like to learn more about microformats, you can read
    this article from Smashing Magazine: [http://coding.smashingmagazine.com/2007/05/04/microformats-what-they-are-and-how-to-use-them/](http://coding.smashingmagazine.com/2007/05/04/microformats-what-they-are-and-how-to-use-them/)'
  prefs: []
  type: TYPE_NORMAL
- en: Adding Google Analytics
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Every website should have analytics. If not, it's difficult to say how many
    people are hitting your site, if we're getting people through our conversion funnels,
    or what pages are causing people to leave our site.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s enhance the global JavaScript (`/js/global.js`) file to automatically
    log each page as it is shown. This is a very important distinction. In the desktop
    world, every analytics hit is based on the document ready event. That will not
    work for **jQuery Mobile** (**jQM**) because the first page in an Ajax based navigation
    system is the only one that ever triggers a page load event. In jQM, we need to
    trigger this on the `pageshow` event using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: By using an asynchronous call to pull in Google Analytics, we are allowing the
    user to proceed, even if tracking is non-functional or taking a while to load.
    Typically, a call to a JavaScript file will pause all further asset loading and
    JavaScript execution until the requested script has been fully loaded and executed.
    We really don't want to have our otherwise well-crafted, speedy, and functioning
    page held up because some ad network or analytics tracking is taking a while to
    respond.
  prefs: []
  type: TYPE_NORMAL
- en: We pull the location to be tracked from the `data-url` attribute of the current
    page because you cannot reliably use the `document.location` function for your
    page hit tracking. jQM's Ajax based navigation leads to some very strange URLs
    in your tracking. The jQM team is working on that but it will be a while until
    the needed technology is present on all devices. Instead, just pull the URL to
    track from the `data-url` attribute of the jQM page. If you dynamically create
    your pages, this is where you would also put the custom name for your page for
    tracking purposes. If you're using multi-page templates, each page's ID will be
    tracked as the page view.
  prefs: []
  type: TYPE_NORMAL
- en: 'We really haven''t done much analytics work yet, but let''s look at some of
    the insights we can already start to glean. Here is just a sample of the technology
    breakdowns:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding Google Analytics](img/0069_03_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'The following image shows a full report of the same view broken down a little
    further to show which devices are most poplar:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding Google Analytics](img/0069_03_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Pay attention to the **Bounce Rate** column in the previous image on each platform
    as a whole. If one is significantly higher than the other, it could be an indicator
    that we need to look a little closer at our site on that device.
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding Google Analytics](img/0069_03_03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Making a mobile website is about much more than simply making it look pretty
    on mobile browsers. The best indicator of a well-tailored mobile site is that
    people are able to get in and find what they need quickly. That makes the Top
    Content report our new best friend.
  prefs: []
  type: TYPE_NORMAL
- en: Unsurprisingly, most people who come to the site are hitting the menu as shown
    in the report in the previous image. However, the menu is nothing but a starting
    point. What are they most interested in within the menu? Specialty pizzas. It
    is this kind of an insight that can lead you to a successful first redesign. Perhaps,
    we should think about featuring the specialties on the homepage and save our users
    time.
  prefs: []
  type: TYPE_NORMAL
- en: The bottom line is, without good analytics, you have no idea if you're building
    the right thing. The site, as designed right now, is making them go two clicks
    deep to see what's most cared about, or is it?
  prefs: []
  type: TYPE_NORMAL
- en: So far, we've only tracked page views. But, in the mobile word, that's not the
    whole picture. What about the links that dial the phone number but do not fire
    a page view? What about links that go off-site to Facebook or to mapping software,
    such as Google Maps? Those certainly count as further interactions but it would
    be nice to have numbers on all of these kinds of clicks too. We're already tracking
    page views differently, let's continue.
  prefs: []
  type: TYPE_NORMAL
- en: 'Naturally, we want to track custom events and not have to write JavaScript
    for every event we want to track. Let''s make our links like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, let''s add a little more to the `pageinit` handler using the following
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'There is a lot more that can be done with analytics tracking such as custom
    event tracking, e-commerce campaign tracking, goals tracking, and so on. Now that
    you know the basics of how to tie Google Analytics into jQuery Mobile, you can
    continue to explore more tracking as wisdom dictates by looking here: [https://developers.google.com/analytics/devguides/collection/gajs/](https://developers.google.com/analytics/devguides/collection/gajs/).'
  prefs: []
  type: TYPE_NORMAL
- en: Long and multi-page forms
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'On desktops, long forms are pretty normal. We''ve all seen registration pages
    and e-commerce ordering processes. The longer the form is, the greater the tendency
    to try to break them up into smaller, more logical pieces. This is usually done
    in a couple of ways:'
  prefs: []
  type: TYPE_NORMAL
- en: Leave it as a full page but inject enough whitespace and grouping that it doesn't
    look quite so intimidating
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Either physically break the form into multiple pages or use show/hide techniques
    to accomplish the same thing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Neither of these approaches makes a lot of difference with regards to task
    completion. Either way, both methods are particularly unfavorable strategies within
    the constraints of mobile. The best things we can do to increase success are:'
  prefs: []
  type: TYPE_NORMAL
- en: Completely eliminate all optional fields
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reduce the number of required fields as much as possible (get vicious about
    it)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Pre-fill elements with reasonable defaults
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Validate fields immediately instead of waiting till the end
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Give the user upfront notice about how long the task is likely to take
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Even doing this, sometimes forms are just going to be long. If you run into
    this situation, here is a useful way of taking a long form and breaking it into
    several pages using jQuery Mobile. Here is the code from `ordercheckout.php`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The very first thing to note here is that the body and form tags are outside
    all jQuery Mobile pages. Remember, all of this is just one big Data Object Model
    (DOM). All the crazy progressive enhancements and page shifting in the UI don't
    change that. This page, at its heart, is one massive form that we will use to
    submit the entire order process all at once.
  prefs: []
  type: TYPE_NORMAL
- en: Integrating jQuery Validate
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It's always been important to the user experience to validate as much as possible
    on the client. HTML5 goes a long way to this end by giving far greater control
    over input types. As good as HTML5 input types are, we'll need more. Enter Query
    Validate. ([http://bassistance.de/jquery-plugins/jquery-plugin-validation/](http://bassistance.de/jquery-plugins/jquery-plugin-validation/))
  prefs: []
  type: TYPE_NORMAL
- en: The Validate plugin is a staple in the jQuery community but there are certain
    things that will help our mobile implementation. Let's start with automatically
    adding validation to any page that has a form with a class of `validateMe`.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Since it is possible that a page might contain multiple forms, let''s just
    deal with it now by hooking it into every form that requests validation, using
    the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'By default, `ValidateMe` places errors after the invalid field. That won''t
    do in mobile because the errors would show up underneath the form element. On
    BlackBerry and some Android systems, the form element is not necessarily centered
    vertically within the space between the keyboard and the field itself. If the
    user has botched it, the feedback won''t be immediate and obvious. That''s why
    we are making two changes to the error placement using the following code line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: On any given element, we can specify where we want the error to be placed using
    standard jQuery selectors, as shown in the following code line. Perhaps we'll
    never use it but it's handy to have.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: If no error placement has been specified at the element level, we'll inset the
    error before the element itself, as shown in the following code line. Error language
    will show up between the label text and the form element. This way, the keyboard
    will never eclipse the feedback.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: In a single-form, multi-page environment, we want to be able to validate one
    jQM page at a time before proceeding to the next page. The first thing we'll need
    to do is give an alternate way of dealing with the `required` function, since
    we're clearly not validating the entire form at once.
  prefs: []
  type: TYPE_NORMAL
- en: 'This can be declared outside any functions in our global script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Adding additional `validator` methods like this are very handy. We can declare
    our own validation methods for just about anything.
  prefs: []
  type: TYPE_NORMAL
- en: 'For your quick reference, here are the other Validate options:'
  prefs: []
  type: TYPE_NORMAL
- en: '`required`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`remote`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`email`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`url`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`date`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`dateISO`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`number`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`digits`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`creditcard`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`equalTo`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`accept`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`maxlength`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`minlength`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`rangelength`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`range`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`max`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`min`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: For more inspiring demos, please check out [http://bassistance.de/jquery-plugins/jquery-plugin-validation/](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)
    and consider making a donation to the project. It has made all of our lives better.
  prefs: []
  type: TYPE_NORMAL
- en: '![Integrating jQuery Validate](img/0069_03_04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Now that we have properly integrated jQuery Validate into our multi-page form,
    we need to make our errors look like proper errors. We could go with something
    really simple, such as a red color on the text, but I much prefer keeping with
    the style of jQuery Mobile. Their default theme set has a `data-theme="e"` that
    is just begging to be used for error states. It might seem like a good idea to
    just add our error classes onto the very definitions of their `ui-bar-e,` but
    don''t. jQuery Mobile was patched three times during the writing of this book
    and if we were to take that approach it would cause friction with every upgrade.
    Instead, let''s just copy the definition of `ui-bar-e` right into our custom stylesheet,
    as shown in the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'We''re almost ready to go with our fancy forms. Now we just need to be able
    to make it validated before moving from page to page. We don''t have to worry
    about the submit link, as that will naturally trigger validation, but let''s add
    a class to the continue link using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, in our global scripts, let''s add this function to our `pageinit` handler
    using the following code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'What happens if the user refreshes in the middle of this process? The fields
    will be empty but we''ll already be on to the next page. One little script at
    the bottom of the page, as shown in the following code, should handle that:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'Now that we have the basic concepts and have overcome a few minor pitfalls,
    let''s see the finished code of the `ordercheckout.php` file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'Here is the first page of our multi-page form. Remember that these pages will
    all be submitted at once. We''ll be validating each page using the following code
    before the user can move to the next:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: This is the second page of the form for collecting payment information. Note
    the validation of the credit card. All we have to do is add the class `"creditcard"`
    to make the framework check if the card number validates with the Luhn algorithm
    ([http://en.wikipedia.org/wiki/Luhn_algorithm](http://en.wikipedia.org/wiki/Luhn_algorithm)).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'These are the scripts we had mentioned earlier in the chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'Here is the `meta.php` file since integrating jQuery Validate:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'After three chapters, here is what could conceivably be called the master JavaScript
    file (`global.js`). It is essentially the one I use in every project with only
    minor variations:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: E-commerce tracking with Google Analytics
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: So far, all we have tracked is page views. Very useful to be sure, but most
    managers and owners love their reports. On the Thank You page, we should include
    some simple e-commerce tracking. Again, because of jQuery Mobile's Ajax-based
    navigation system, we'll need to tweak the default examples just a hair to make
    it work perfectly with jQM.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the full code for the Thank You page (`thankyou.php`) with e-commerce
    tracking set to only run once the page is shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Forms are nothing new. We've had them since the dawn of the Internet. They are
    not glamorous, but they can be elegant, effective, and responsive. jQuery Mobile
    takes you a long way toward effective forms in touch-based interfaces. Now you
    can take it farther with multi-page forms and client-side validation. Do not underestimate
    the power of these two techniques when paired together. When the client is able
    to do virtually everything they need, without having to go back to the server,
    the experience is automatically improved. Mixing in the ability to watch how users
    are surfing your site, their favorite content, and their fallout points will help
    you make an even more compelling experience. Just remember, when you're thinking
    about analytics, it is not the absolute numbers that are important. It's all about
    the trends; with these basics done, let's get to some more interesting tech. In
    the next chapter, we'll start looking at geolocation and more.
  prefs: []
  type: TYPE_NORMAL

- en: Chapter 11. HTML5 and jQuery Mobile
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Using the new HTML5 semantics
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Improving speed and taking your application offline
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using Web Workers for intensive tasks
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using local and session storage
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2D drawing with Canvas
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Applying Gaussian blur on a SVG image
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tracking your location with the Geolocation API
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Playing music with the `<audio>` element
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Viewing videos with the `<video>` element
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: HTML5 introduces new semantics and many new cool features, such as Application
    Cache, 2D Canvas, Geolocation, Local and Session Storage, Web Workers, and support
    for audio and video. The jQuery Mobile framework is built on HTML5 and CSS3, and
    provides excellent support for these new semantics and new features. This chapter
    introduces some of these features that you can use in your jQuery Mobile apps.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There are many resources on the web for learning HTML5\. To mention a few, you
    can read more at HTML5 Rocks ([http://www.html5rocks.com/en](http://www.html5rocks.com/en)),
    HTML5 Demos ([http://www.html5demos.com](http://www.html5demos.com)), and the
    Mozilla Developer Network ([https://developer.mozilla.org/en-US/docs/HTML/HTML5](https://developer.mozilla.org/en-US/docs/HTML/HTML5)).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: The support for HTML5 elements and features on various browsers and platforms
    is varied. You will have to take care while using a particular feature and ensure
    that it works on your target platforms. This level of support continues to improve
    with every passing day.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '[http://www.caniuse.com](http://www.caniuse.com) has a good reference on the
    updated status of platform support available for the various HTML5 features.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: Using the new HTML5 semantics
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'HTML5 defines new semantics to better organize an HTML document into more logical
    sections. This recipe shows you how to use the new HTML5 semantics to define your
    jQuery Mobile app. The following HTML5 elements are covered in this recipe:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: '`section`: This defines the section in a document. Headers, footers, and the
    page content are all sections.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`header`: This defines the document header.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`footer`: This defines the document footer.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`aside`: This defines the additional content related to the main content of
    the document, usually placed as a sidebar.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`article`: This defines the content related to the document, but it can also
    stand alone and can be independently distributed.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`nav`: This is a section providing navigation links and can contain one or
    more anchor links.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/semantics` folder. You
    can launch this code using the URL: `http://localhost:8080/11/semantics/main.html`.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are as follows:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html` that uses the new HTML5 semantics for the page; do not use
    the `<div>` tag here:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: How it works...
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Create `main.html`, and add the `#main` page to it using a `<section>` tag with
    the `data-role='page'` attribute. Add the `<header>` tag with `data-role='header'`
    to create the page header. Next, add a `<section>` tag with `data-role='content'`
    to create the page content section. Finally, add the footer with the `<footer>`
    tag with the `data-role='footer'`attribute. You now have the page with a header,
    content, and footer ready. You will note that `<div>` has not been used so far.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the `<aside>` and `<article>` elements to the page content, as shown in
    the code. Since there are multiple articles, you can group them in a `<section>`
    element. Finally, add a `<nav>` element with two button links to the page footer.
    Add the `ui-btn-right` class to move the second button to the right side of the
    screen. Now, when you launch the app, the following screen will be displayed:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_01.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'HTML5 supports many more new elements, such as:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '`figure`: This is used to contain images, photos, diagrams, illustrations,
    and so on.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`figcaption`: This defines the caption for `<figure>.`'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`hgroup`: This is used to group a set of header elements (`<h1>`,`<h2>`, and
    so on).'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`mark`: This is used to highlight the text.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`meter`: This is used to specify a numeric value within a min-max range. You
    can also specify a threshold value (low and high).'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`progress`: This is used to indicate progress.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`time`: This is used to mark up a date/time value.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: About using <div>
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Prior to HTML5, `<div>` was used as the container to group elements. But this
    was not very descriptive. The HTML5 document structure is much more descriptive
    and meaningful with header, footer, and so on.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When using HTML5, use `<div>` to group elements that do not fit the description
    of any of the new HTML5 elements, such as `<section>`.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: Using <section> with jQuery Mobile
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Support for HTML5 semantics is varied and improving in the numerous platforms
    available on the market today. As of v1.1.1, the jQuery Mobile framework recommends
    using the `<div>` element with the `data-role` attribute to specify the various
    page components, such as header and footer. This is to ensure compatibility with
    the older versions of browsers, such as IE8, and also to support the maximum number
    of devices and platforms. This would definitely change in a near future version
    of jQuery Mobile, when support for the older browsers is dropped. Till then, use
    the new HTML5 elements, keeping your target users in mind.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Improving speed and taking your application offline
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: HTML5 introduced a new feature called **Application Cache** that allows your
    web app to cache network resources locally. You can also control and configure
    this cache much better than the earlier browser caching techniques. With Application
    Cache, your mobile app can work better, even in situations where there is slow
    or no network coverage. Your app is faster, as it can find many of the resources
    stored locally instead of fetching them from the server. This also helps the user
    with lower data transfer costs that would be charged by the service provider.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: This recipe shows you how to use the Application Cache feature in your jQuery
    Mobile app. It also shows you how to use a locally stored jQuery Mobile library
    instead of fetching the library files from the CDN.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/appcache` folder. You will
    have to host this code on a web server to see how Application Cache works. The
    `sources` folder contains a `nodejs` web server that you can use to run this app.
    You can launch this code using the URL: `http://localhost:8080/11/appcache/main.html`.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html`, and specify the manifest file in the `<html>` tag:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Add the following three links to the page content in `main.html`:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Create the following `jqmcookbook.appcache` manifest file and specify the files
    that are to be cached:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Create the following `cached.html` file, which gets cached by the app, and
    is available for offline access:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Create the following `online.html` file, which does not get cached and is fetched
    from the network every time it is accessed:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Create the following `offline.html` file that gets cached and is used as a
    fallback when the `online.html` page is not accessible over the network:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Finally, create the following `network.html` file that does not get cached,
    and is always fetched from the network; it does not use any fallback:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How it works...
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Create `main.html`, and specify `jqmcookbook.appcache` as the manifest file
    in its `<html>` tag. This indicates to the browser that the HTML file should be
    cached. It also indicates that the manifest file must be processed for finding
    all the resources that are to be cached locally. Add three links for the `cached.html`,
    `online.html`, and `network.html` pages, as shown. These will be used as the resources
    that will be cached in this recipe.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: Create the `jqmcookbook.appcache` manifest file with the text `CACHE MANIFEST`
    specified in its first line. You can add comments to the manifest file, and they
    start with the `#` character. Now, add the resources to be cached by your app
    to the manifest file. Each filename must be on a separate line, and you can use
    relative or absolute paths. The Cache Manifest file has three sections identified
    by the `CACHE`, `FALLBACK`, and `NETWORK` headers.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: Define the default `CACHE` section and list the files that should be cached
    locally. Add `main.html` and `cached.html` to this section. When you launch the
    app and click on the first button, it opens `cached.html` regardless of whether
    the device is online or offline.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 定义默认的`CACHE`部分，并列出应该在本地缓存的文件。将`main.html`和`cached.html`添加到此部分。当你启动应用程序并点击第一个按钮时，无论设备是在线还是离线，它都会打开`cached.html`。
- en: Note
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Images, icons, stylesheets, JavaScript, and other static files are the resources
    that you should cache locally.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图像、图标、样式表、JavaScript和其他静态文件都是你应该在本地缓存的资源。
- en: Cached files are downloaded only at the first time. When the app tries to access
    any of these files, they are always fetched from the cache first or, only if not
    available, they are fetched from the server.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 缓存文件只有在第一次下载时才会被下载。当应用尝试访问这些文件中的任何一个时，它们总是首先从缓存中获取，或者只有在缓存中不存在时才会从服务器获取。
- en: Note
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is good practice to cache the main HTML file (with the manifest defined in
    its `<html>` tag) in your app.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 在应用程序中缓存主HTML文件（在其`<html>`标签中定义了清单）是个不错的做法。
- en: Next, define the `FALLBACK` section with two filenames in each line. Specify
    `online.html` as the first file, and then specify the fallback as `offline.html`.
    Now, when you click on the second button in the app, `online.html` is shown only
    if the device is online. If the device goes offline, then `offline.html` is automatically
    shown from the cache. Here, the first file is always fetched from the network
    and is never cached.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，定义`FALLBACK`部分，每行定义两个文件名。将`online.html`指定为第一个文件，然后将`offline.html`指定为后备。现在，当你点击应用程序中的第二个按钮时，只有在设备在线时才会显示`online.html`。如果设备离线，那么`offline.html`将自动从缓存中显示。在这里，第一个文件总是从网络获取，而不会被缓存。
- en: Finally, define the `NETWORK` section with `network.html` listed in it. Use
    this section to define the list of files that should never be cached in your app.
    These files are always fetched from the network. Now, when you click on the third
    button, `network.html` is shown only if the device is online, and an error is
    shown if the device is offline.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，定义`NETWORK`部分，并将`network.html`列在其中。使用这部分来定义在您的应用中永远不应该被缓存的文件列表。这些文件总是从网络获取。现在，当你点击第三个按钮时，只有在设备在线时才会显示`network.html`，如果设备离线，则会显示错误。
- en: There's more...
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: You can see the list of currently cached files in your browser using the developer/debugging
    tools that most browsers provide today. The following screenshot shows the Chrome
    Developer Tool's view of the resources that have been cached for the `main.html`
    file in this recipe. The files listed in the manifest are all seen in the **Application
    Cache** section.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用大多数浏览器提供的开发者/调试工具在浏览器中看到当前缓存的文件列表。以下截图显示了Chrome开发者工具中对本文档中`main.html`文件缓存资源的视图。清单中列出的文件都在**Application
    Cache**部分中看到。
- en: '![There''s more...](img/7225_11_02.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![还有更多...](img/7225_11_02.jpg)'
- en: Restriction on the cache size
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 缓存大小的限制
- en: There is a browser limitation on how much data you can store locally. Usually
    it is 5 to 10 MBs, and requires the user's permission to go over this limit. Some
    browsers, such as Chrome, allow you to set this value as unlimited. So, cache
    files with care and include the resources that you access often. Also include
    resources that you need to take your app offline.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览器对本地存储的数据量有限制。通常是5到10 MB，需要用户允许超过此限制。一些浏览器，如Chrome，允许你将此值设置为无限制。因此，小心地缓存文件，并包括你经常访问的资源。还包括那些需要让您的应用离线的资源。
- en: Refreshing the Application Cache
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 刷新应用程序缓存
- en: Each time the `main.html` file is accessed, the remote manifest file is fetched
    and is compared with the local manifest file. Only if the manifest has changed
    (this could be even just a comment), the new manifest file is fetched. Then the
    cache will be cleared and the entire set of cached files will be refreshed from
    the server. The flip side to this is that, just adding a single new file to the
    manifest file will trigger a full refresh, even if none of the other files have
    changed.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 每次访问`main.html`文件时，远程清单文件都会被获取并与本地清单文件进行比较。只有清单文件已更改（这甚至可能只是一个注释），新的清单文件才会被获取。然后缓存将被清除，并且整套缓存文件将从服务器刷新。与此相对的是，即使其他文件没有发生变化，向清单文件中添加一个新文件也会触发完全刷新。
- en: Note
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Using a version number in the comment of the manifest file is a good way of
    keeping the cached files updated.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在清单文件的注释中使用版本号是保持缓存文件更新的好方法。
- en: The MIME type of the manifest file
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 清单文件的MIME类型
- en: You should always serve the manifest file with the **MIME** type of text/cache-manifest.
    You can name this manifest anything. Your server should be able to recognize this
    MIME type. If it does not, you should add this MIME type to your server configuration.
    The nodejs web server that is shipped with the sources for this cookbook, already
    supports the text/cache-manifest MIME type.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: The Ajax pre-filter workaround
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Application Cache does not work properly on some browsers and the Ajax pre-filter
    workaround is required in this case. In these browsers, a successful Ajax call
    returns a `0` HTTP status on success. To work around this, you should use a jQuery
    Ajax pre-filter and set the `isLocal` attribute to `true`. The detailed github
    discussion thread on using the `isLocal` workaround is available at [https://github.com/jquery/jquery-mobile/issues/1579](https://github.com/jquery/jquery-mobile/issues/1579).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Using Web Workers for intensive tasks* recipe
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Chapter 2](ch02.html "Chapter 2. Pages and Dialogs"), *Pages and Dialogs*,
    The *Prefetching pages for faster navigation* and The *Using the DOM cache to
    improve performance* recipes'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using Web Workers for intensive tasks
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When you run a script that does some complex or lengthy activity, the browser
    thread freezes and does not respond till the task is complete. This can be overcome
    by using a Web Worker—a background independent thread that is used to run JavaScript.
    The browser thread is not blocked, and thus can continue to respond to user actions.
    This recipe shows you how to use Web Workers.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/webworkers` folder. You
    can launch this code using the URL: `http://localhost:8080/11/webworkers/main.html`.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be performed are as follows:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html` with a checkbox and a slider as its page content:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Add the following script to trigger a long running loop when the checkbox is
    clicked. When checked, the loop is run in a Web worker and there is no UI freeze,
    and you can continue to use the page. When the checkbox is unchecked, immediately
    everything freezes till the loop is done.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Finally, add the `webworker.js` JavaScript file to handle the loop:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: How it works...
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Create `main.html`, and add a slider and a checkbox with `id='countchk'` to
    the content of `#main`. Also, add an empty `#msgdiv` attribute to display the
    messages. Bind the `change` event of the checkbox to an event handler in the `pageinit`
    callback.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: When the checkbox is selected, trigger the loop in a Web Worker. Initiate the
    Web Worker by calling `new Worker()`, and pass it the name of the JavaScript `webworker.js`
    file. Define the `onmessage` event handler to handle messages received by the
    worker. You can display this message in `#msgdiv`. Finally, invoke the worker
    by posting a `start` message to it. This message can be anything, and the code
    must be written in the worker to handle it. In the file `webworker.js`, define
    the `onmessage` callback to handle the incoming message from the browser thread.
    Run the loop and return an appropriate message to the main thread.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 当选中复选框时，在 Web Worker 中触发循环。通过调用 `new Worker()` 来启动 Web Worker，并将 JavaScript
    `webworker.js` 文件的名称传递给它。定义 `onmessage` 事件处理程序来处理工作器接收到的消息。您可以在 `#msgdiv` 中显示此消息。最后，通过向其发送
    `start` 消息来调用工作器。这个消息可以是任何东西，必须在工作器中编写代码来处理它。在文件 `webworker.js` 中，定义 `onmessage`
    回调来处理来自浏览器线程的传入消息。运行循环并向主线程返回相应的消息。
- en: 'When you launch the page and select the checkbox, the loop is initiated in
    a Web Worker. You can use the slider and see the messages being updated in the
    page even though the loop is still running:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 当您启动页面并选择复选框时，循环将在 Web Worker 中启动。您可以使用滑块，即使循环仍在运行，也可以看到页面中的消息被更新：
- en: '![How it works...](img/7225_11_03.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![工作原理……](img/7225_11_03.jpg)'
- en: 'When the checkbox is not selected, the loop runs in the main browser thread
    itself. Now, the entire UI freezes even before the checkbox can reflect your click,
    and the UI responds only after the loop is completed:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 当复选框未被选中时，循环将在主浏览器线程中运行。现在，在复选框可以反映您的选择之前，整个界面都会冻结，并且只有在循环完成后界面才会响应：
- en: '![How it works...](img/7225_11_04.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![工作原理……](img/7225_11_04.jpg)'
- en: There's more...
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: Support for Web Workers might not be available in all browsers. You can check
    for the Web Worker support in your app by calling the following code, which checks
    for the presence of the `Worker` property of the `window` object. If undefined,
    the feature is not available.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有浏览器中可能并不支持 Web Workers。您可以通过调用以下代码来检查应用程序中对 Web Worker 的支持情况，该代码检查 `window`
    对象的 `Worker` 属性是否存在。如果未定义，则表示不支持该功能。
- en: '[PRE11]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Using Modernizr to check for Web Worker support
  id: totrans-121
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 Modernizr 检查 Web Worker 的支持
- en: '**Modernizr** (available at [http://www.modernizr.com](http://www.modernizr.com))
    is a very popular and handy library that can be used to detect the support for
    Web Workers and other HTML5 and CSS3 features in your browser. It provides **polyfills**
    or **fallbacks** in case a particular property is not supported in a browser.
    It comes with an **MIT** **license** , and can be freely used. The `Modernizr.webworkers`
    property would be defined and available if your browser supports Web Workers.'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '**Modernizr**（位于 [http://www.modernizr.com](http://www.modernizr.com)）是一个非常受欢迎和方便的库，可用于检测浏览器中对
    Web Worker 和其他 HTML5 和 CSS3 功能的支持。它提供 **polyfills** 或 **fallbacks** ，以防某个属性在浏览器中不受支持。它使用
    **MIT** **许可证** ，可以自由使用。如果您的浏览器支持 Web Workers，`Modernizr.webworkers` 属性将被定义和可用。'
- en: See also
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: The *Improving speed and taking your application offline* recipe
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*改进速度并使应用离线* 配方'
- en: Using local and session storage
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用本地和会话存储
- en: '**Cookies** was the mechanism used to store client-side information earlier.
    But a cookie can only store up to 4 KB of data, which is sent to the server with
    every single request. **Web Storage** is the client-side storage standard introduced
    with HTML5\. It has two types: **Local Storage** and **Session Storage** . Data
    stored in Session Storage is available till the user''s session is active, and
    is lost once the session ends. Local Storage data is persisted across sessions.
    This recipe shows you how to use Local Storage and Session Storage.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '**Cookies** 曾是以前用于存储客户端信息的机制。但是一个 cookie 只能存储最多 4 KB 的数据，这些数据将随每个请求发送到服务器。**Web
    Storage** 是在 HTML5 中引入的客户端存储标准。它有两种类型：**本地存储** 和 **会话存储** 。会话存储中存储的数据在用户会话处于活动状态时可用，并在会话结束后丢失。本地存储中的数据在会话之间持久存在。该配方向您展示如何使用本地存储和会话存储。'
- en: Getting ready
  id: totrans-127
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'Copy the full code of this recipe from the `code/11/storage` folder. You can
    launch this code using the URL: `http://localhost:8080/11/storage/main.html`.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 从 `code/11/storage` 文件夹复制此配方的全部代码。您可以使用以下 URL 启动此代码：`http://localhost:8080/11/storage/main.html`。
- en: How to do it...
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到……
- en: 'The steps to be followed are:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 应遵循的步骤为：
- en: 'Create `main.html` with its page content having three text fields and a **Save**
    button:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建带有三个文本字段和一个 **保存** 按钮的 `main.html`：
- en: '[PRE12]'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Add the following script to persist the text field contents by clicking on
    the **Save** button:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Finally, restore the persisted values when the page is shown:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Refresh the page, and later close and reopen the page to see how these persisted
    values behave over a single session and across multiple sessions.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Add three texts with IDs: `nostore`, `sessionstore`, and `localstore`. Add
    a button with `id=''savebtn''`, and bind its `click` event to a callback in the
    `pageinit` event handler. In the callback, persist the text fields by calling
    the `setItem()` method with unique keys (`localval` and `sessionval`) on the `window.sessionStorage`
    and `window.localStorage` objects respectively.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: To restore these persisted values when the page reloads or refreshes, add an
    event handler to the `pageshow` event. Pass the `localval` key to the `window.localStorage.getItem()`
    function to read from local storage. Pass the `sessionval` key to `window.sessionStorage.getItem()`
    to read from session storage. Set these values to the respective text fields.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: When the app loads, enter the text values and click on the **Save** button to
    persist them.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_05.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
- en: 'Next, refresh the browser to reload the page. The session is still alive, and
    you will see the local and session storage values get restored. The first field
    is cleared as it was not persisted, as shown in the following screenshot:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_06.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
- en: 'Finally, close the app and reopen it. This time, the session is terminated.
    You will see that only the **Local Storage** data is shown and the other two text
    fields are cleared:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_07.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Support for Web Storage might not be available in all browsers. You can check
    if the `window` object has a valid `localstorage` or `sessionStorage` property
    to verify if you can use the feature by running the following code:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: You can also use the free `Modernizr` library to test for Web Storage support
    by checking if the `Modernizr.localstorage` and the `Modernizr.sessionstorage`
    properties are valid.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: Inspecting the Web Storage
  id: totrans-151
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'You can open the developer tools in your browser and inspect the current set
    of key-values stored in your browser for the Local and Session Storage. The following
    screenshot shows the Local Storage key-value that was saved in this recipe:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
- en: '![Inspecting the Web Storage](img/7225_11_08.jpg)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
- en: 'The following screenshot shows the key-value stored using **Session Storage**:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: '![Inspecting the Web Storage](img/7225_11_09.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
- en: WebSQL Storage
  id: totrans-156
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: WebSQL Storage is another feature that was defined in HTML5 to store client-side
    data. It uses SQLite queries to perform the data operations. Both IE and Firefox
    do not support this feature. This specification is no longer being maintained
    and might be dropped going forward.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: IndexedDB Storage
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The **IndexedDB** **Storage** is another form of client-side storage using indexed
    data queries. Only Firefox and Chrome browsers support this feature well at the
    time of writing this recipe. Older IE versions, Safari, and Opera do not support
    this feature.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: 2D drawing with Canvas
  id: totrans-160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Canvas** is a rectangular region in your web page where you can draw 2D shapes
    using JavaScript, and also render bitmap images. It is used for graphs, animations,
    images, photo compositions, real-time video processing, and games. This recipe
    shows you how to use the Canvas in your jQuery Mobile app.'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-162
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/canvas` folder. You can
    launch this code using the URL: `http://localhost:8080/11/canvas/main.html`.'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-164
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html` with its page content having a `canvas` element:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Add the following script to get the 2D context, and then draw two rectangles:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: How it works...
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create `main.html`, and add a `<canvas>` element with `id=''mycanvas''` to
    the `#main` page with `width` and `height` of `500` pixels. The text **Canvas
    is not supported on your browser** is shown if the browser does not support the
    Canvas feature. Next, add a script to the `pageinit` callback function to get
    the 2D context (`cxt`) of the `mycanvas` element. Define the `fillStyle` of `cxt`
    with a grey shade `#5f98c5`. Now, draw a filled rectangle using `fillRect()`,
    passing the origin, length, and breadth as parameters. Next, use `strokeRect()`
    to draw a rectangle outline without any fill. The screen is now displayed, as
    shown in the following screenshot:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_10.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This recipe just gives a basic introduction to the Canvas element, and shows
    you how to use it in your jQuery Mobile app. The Canvas is a very powerful element
    and supports a wide array of APIs. You can set colors, styles, gradients, patterns,
    fonts, and text alignment. You can draw geometric shapes, such as lines, rectangles,
    paths, arcs, and bezier curves. The canvas supports transformation APIs, such
    as scale, rotate, translate, and transform. You can draw images and also manipulate
    them at a pixel level. Canvas helps in photo composition. You can also save the
    drawing state of the canvas in a stack, and restore any previous saved drawing
    state from the stack.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The elements drawn on a canvas take in absolute coordinates. So, take care while
    using these values, keeping in mind the actual screen size of your target devices.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Applying Gaussian blur on a SVG image* recipe
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Applying Gaussian blur on a SVG image
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Scalable Vector Graphics** (**SVG**) is a family of specifications for 2D
    Scalable Vector Graphics. They are XML-based and can be static or dynamic (animated
    or interactive). This recipe shows you how to use a SVG image in your app, and
    apply a Gaussian filter when you click on it.'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/svg` folder. The SVG image
    is available in the `code/resources/images` folder. You can launch this code using
    the URL: `http://localhost:8080/11/svg/main.html`.'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html` with a SVG element in its page content. Draw a SVG rectangle
    and display the SVG image within the rectangle:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Apply the Guassian filter to the SVG image when the image is clicked:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: How it works...
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create `main.html`, and add a `<svg>` element to its page content. Specify
    the SVG namespace and version, as shown in the code. Create a rectangle using
    the `<rect>` element, and specify its attributes, such as the width, height, and
    x and y positions, and also set its `stroke` style. Next, add an `<image>` element
    with `id=''svgimg''` pointing to the SVG image, and specify the image''s location,
    position, and size to be used. When you load the page, the following screenshot
    will be shown:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_11.jpg)'
  id: totrans-191
  prefs: []
  type: TYPE_IMG
- en: 'Now, define the Gaussian filter by adding a `<filter>` element with `id=''gausfilter''`
    inside a `<defs>` element. Add the `<feGaussianBlur>` element inside `<filter>`,
    and set a standard deviation of `5`. Finally, bind the `click` event on the `#svgimg`
    image to an event handler in the `pageinit` callback function. Here, add the `filter=''gausfilter''`
    attribute to the `<image>` tag using the jQuery `attr()` call. Now, when you click
    on the SVG image, the Gaussian blur gets applied, as shown in the following screenshot:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_12.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-194
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: SVG supports vector graphics, raster graphics, and text elements. It allows
    you to transform, clip paths, apply alpha masks, and filter effects on the SVG
    images. The SVG image used in this recipe was designed and contributed to the
    *Open Clipart* website at [http://openclipart.org](http://openclipart.org), by
    ChrisDesign ([http://chrisdesign.wordpress.com](http://chrisdesign.wordpress.com)).
    The Open Clipart website also has thousands of free SVG images available in the
    public domain.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: SVG Tiny specification
  id: totrans-196
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The SVG specification has a mobile version, and it is called the **SVG Tiny**
    (**SVGT**) specification. Currently, SVGT v1.2 is the W3C recommendation. It has
    good support on most of the mobile devices and platforms, and support for it continues
    to improve by the day.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-198
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *2D drawing with Canvas* recipe
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tracking your location with the Geolocation API
  id: totrans-200
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The **Geolocation API** is a separate specification and is part of the HTML5
    stack. You can use JavaScript and locate the client device location using various
    techniques, such as IP address, Wi-Fi, GSM/CDMA cell IDs, or device Global Positioning
    System (GPS). This recipe shows you how to find the current location using the
    Geolocation API in your app.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-202
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/geolocation` folder. You
    can launch this code using the URL: `http://localhost:8080/11/geolocation/main.html`.'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-204
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: Create `main.html` with an empty `div` tag to display the geolocation information.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-207
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Invoke the `getCurrentPosition()` method to obtain the current location using
    a `show_pos()` callback function.
  id: totrans-208
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Finally, display the current location in the `show_pos()` callback function:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: How it works...
  id: totrans-212
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Create `main.html`, and add an empty `div` tag with `id='geopos'` to the `#main`
    page to display the location information. Use the `pageinit` event handler to
    first check if the `navigator.geolocation` object is available. If available,
    invoke the `getCurrentPosition()` method with a callback function, `show_pos()`,
    to get the location information. The `show_pos()` callback function can access
    the position (`pos`) object, which has the various properties of the current location.
    Access `pos.coords` to obtain information, such as the latitude, longitude, altitude,
    and accuracy. The `pos` object also has an associated timestamp for the current
    location reading. Now, display the location details in the `#geopos` attribute
    of `div`.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: 'When you launch the app, the browser first asks your permission to access the
    location information. Once you agree, the following location details are shown
    on the screen:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The Geolocation API specification mandates that the user location information
    is confidential, and that the browser should warn and obtain the user's permission
    before accessing or sharing this information.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_13.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-218
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, the `getCurrentPosition()` call pings for the user location
    only once, and displays the information using the `show_pos()`callback function.
    But, if you wish to track a moving device, you can access continuous location
    readings using the `watchCurrentPosition()` call. The syntax remains the same,
    but this method continuously and periodically keeps pinging for the device location
    and invokes the `show_pos()` callback every time. This method also populates the
    `pos.coords.speed` and `pos.coords.heading` attributes to give feedback on the
    speed and direction of the moving device. The user is prompted for permission
    to share the location details only on the first call.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Google Gears
  id: totrans-221
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Prior to the Geolocation API specification, the Google Gears JavaScript library
    was very popular for fetching location information. Google Gears subsequently
    contributed quite a bit to the development of the Geolocation API and is now deprecated.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
- en: Geolocation on desktop browsers
  id: totrans-223
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The location information obtained on desktop browsers is based on the IP and
    MAC address details obtained from the ISP servers. So, this information has a
    wide accuracy margin, sometimes in the range of a few kilometers, whereas mobile
    devices rely on the network towers and on GPS devices (if enabled) for positioning.
    Thus mobile devices can very accurately pinpoint the position, altitude, speed,
    and heading information within a range of a few meters.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: Playing music with the <audio> element
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: HTML5 introduced a new `<audio>` element that can be used to play audio files
    directly in the browser. Prior to this, browsers had to use plugins, such as Flash
    Player, Real Player, or Quick Time to play audio files. The `<audio>` element
    provides a lightweight alternative, and this recipe shows you how to use it in
    your app to play audio files.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/audio` folder. The audio
    snips are available in the `code/resources/audio` folder. You can launch this
    code using the URL: `http://localhost:8080/11/audio/main.html`.'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-229
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html` with the `<audio>` element in its page content:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: How it works...
  id: totrans-233
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Add the `<audio>` element to the `#main` page with the `controls`, `autoplay`,
    and `preload` attributes. The `controls` attribute displays the play button, volume
    slider, and other controls. The `preload='auto'` option indicates that the browser
    can start streaming the audio file in the background as soon as the page is ready.
    The `autoplay` attribute tells the browser that it can directly start playing
    the audio file when downloaded and ready.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-235
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `<audio>` element also supports a `loop` attribute, which keeps the audio
    playing in a continuous loop.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
- en: 'Different browsers support different audio formats, and the first supported
    audio format is picked and played. So, add URL links to the audio file in the
    `.mp3`, `.oga`, and `.webma` formats using the `<source>` element, as shown in
    the code. One of these three audio formats will be recognized by most browsers.
    Finally, add an error message, `Browser does not support audio tag`, at the end.
    This message is displayed if the browser does not support the `audio` element.
    Now, when you load the page, the screenshot similar to the following is seen,
    and the audio file starts to play:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_14.jpg)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Older browsers, such as IE8, do not support the `<audio>` element. You will
    have to use a flash fallback mechanism in this case.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
- en: For a note on audio formats and codecs, using the flash fallback and HTML5 media
    players, refer to the next recipe on the `<video>` element.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-242
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Viewing videos with the <video> element* recipe
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Viewing videos with the <video> element
  id: totrans-244
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: HTML5 introduced a new `<video>` element to play video files directly in the
    browser. Prior to this, browsers had to use plugins, such as Flash Player, Real
    Player, or Quick Time to play video files. The `<video>` element is a lightweight
    alternative, and this recipe shows you how to use it in your app to view videos.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Copy the full code of this recipe from the `code/11/video` folder. The video
    snips are available in the `code/resources/video` folder. You can launch this
    code using the URL: `http://localhost:8080/11/video/main.html`.'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The steps to be followed are:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: 'Create `main.html` with the `<video>` element in its page content:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: How it works...
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Add the `<video>` element to the `#main` page with the `controls`, `autoplay`,
    and `preload` attributes. The `controls` attribute displays the play button, volume
    slider, full screen button, and other controls. The `preload='auto'` option indicates
    that the browser can start streaming the video file in the background as soon
    as the page is ready. The `autoplay` attribute tells the browser that it can directly
    play the video when ready. Also, add the `width` and `height` attributes to size
    the video in pixels.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: 'Different browsers support different video formats, and the first supported
    video format is picked and played. So, add URL links to the video files in the
    `.mp4`, `.ogv`, and .`webmv` formats using the `<source>` element, as shown in
    the code. One of these three video formats will be recognized by most browsers.
    Finally, add an error message, `Browser does not support video tag`, at the end.
    This message is displayed if the browser does not support the video element. Now,
    when you load the page, a screenshot similar to the following is shown, and the
    video file starts to play:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/7225_11_15.jpg)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-256
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `<video>` tag also supports a few additional attributes, such as `loop`
    (to play the video in a continuous loop), `muted` (to turn off the audio), and
    `poster` (the URL of the image to be displayed at the beginning as a poster, before
    the video begins to play).
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-258
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Set `preload` to `auto` to automatically download the media file, as some browsers
    do not support `preload` due to security reasons.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: The flash fallback
  id: totrans-260
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Older browsers, such as IE8, do not support the `<video>` and `<audio>` elements.
    You can still play HTML5 audio and video in unsupported browsers by using a flash
    player as the fallback mechanism. You have to embed the player using the `<object>`
    tag at the end of the `<video>` or `<audio>` element. The browser in this case
    does not recognize the new HTML5 tags, and falls through to play the audio/video
    using the flash fallback.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: The Codecs
  id: totrans-262
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There are multiple audio/video formats that are popular on the web today. The
    support is varied in different browsers, which support only specific audio/video
    codecs. You have to ensure that your app works on maximum platforms, by including
    different formats of the same audio/video files, if necessary, as shown in this
    recipe. Detailed information on this matter, including tables showing the support
    matrix, is available at [http://diveintohtml5.info/video.html](http://diveintohtml5.info/video.html).
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
- en: The Audio and Video API
  id: totrans-264
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Audio API** and **Video API** are now available for you to directly control
    the `<audio>` and `<video>` elements using JavaScript. They allow you to trigger
    actions (play, pause, and so on) and listen to events (playing, ended, and so
    on).'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
- en: HTML5 media players
  id: totrans-266
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The HTML5 tags by themselves give you very plain looking UI and controls. You
    can enhance the look and feel and add additional features using the Audio and
    Video API. Instead, with minimal effort, you can also use any of the popular libraries
    that are available, such as **jPlayer** ([http://jplayer.org](http://jplayer.org)),
    **MediaElement.js** ([mediaelementjs.com](http://mediaelementjs.com)), **JW Player**
    ([http://longtailvideo.com](http://longtailvideo.com)), **Video.js** ([http://videojs.com](http://videojs.com)),
    and **Audio.js** ([http://kolber.github.com/audiojs/](http://kolber.github.com/audiojs/)).
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-268
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Playing music with the <audio> element* recipe
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
